openapi: 3.0.3
info:
  title: Bell Notification API
  description: REST API for React Native + Rust Bell Notification App
  version: 1.0.0
  contact:
    name: Uncle-Codeing Development Team
    email: dev@uncle-codeing.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.bellnotification.com
    description: Production server

paths:
  # Health Check
  /health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns API health status and version information
      operationId: getHealth
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  # Bell Audio Management
  /audio/play:
    post:
      tags:
        - Audio
      summary: Play bell sound immediately
      description: สั่งเล่นเสียงระฆังทันทีพร้อมตัวเลือกต่างๆ
      operationId: playBell
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PlayBellRequest'
      responses:
        '200':
          description: Bell played successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PlayBellResponse'
        '400':
          description: Invalid request parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /audio/stop:
    post:
      tags:
        - Audio
      summary: Stop current playback
      description: หยุดการเล่นเสียงปัจจุบัน
      operationId: stopPlayback
      responses:
        '200':
          description: Playback stopped successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StopPlaybackResponse'

  /audio/bell-types:
    get:
      tags:
        - Audio
      summary: Get available bell types
      description: ดึงรายการประเภทเสียงระฆังที่มีให้เลือกใช้
      operationId: getBellTypes
      responses:
        '200':
          description: List of bell types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BellType'

    post:
      tags:
        - Audio
      summary: Create new bell type
      description: สร้างประเภทเสียงระฆังใหม่ (สำหรับ admin)
      operationId: createBellType
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBellTypeRequest'
      responses:
        '201':
          description: Bell type created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BellType'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Schedule Management
  /schedules:
    get:
      tags:
        - Schedules
      summary: Get all schedules
      description: ดึงตารางเวลาทั้งหมดของผู้ใช้
      operationId: getSchedules
      parameters:
        - name: active_only
          in: query
          description: แสดงเฉพาะตารางเวลาที่ใช้งานอยู่
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BellSchedule'

    post:
      tags:
        - Schedules
      summary: Create new schedule
      description: สร้างตารางเวลาใหม่สำหรับการเปิดระฆัง
      operationId: createSchedule
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBellScheduleRequest'
      responses:
        '201':
          description: Schedule created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BellSchedule'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /schedules/{scheduleId}:
    get:
      tags:
        - Schedules
      summary: Get specific schedule
      description: ดึงข้อมูลตารางเวลาตาม ID
      operationId: getSchedule
      parameters:
        - name: scheduleId
          in: path
          required: true
          description: ID ของตารางเวลา
          schema:
            type: integer
      responses:
        '200':
          description: Schedule details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BellSchedule'
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - Schedules
      summary: Update schedule
      description: อัพเดทข้อมูลตารางเวลา
      operationId: updateSchedule
      parameters:
        - name: scheduleId
          in: path
          required: true
          description: ID ของตารางเวลา
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBellScheduleRequest'
      responses:
        '200':
          description: Schedule updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BellSchedule'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - Schedules
      summary: Delete schedule
      description: ลบตารางเวลา
      operationId: deleteSchedule
      parameters:
        - name: scheduleId
          in: path
          required: true
          description: ID ของตารางเวลา
          schema:
            type: integer
      responses:
        '200':
          description: Schedule deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /schedules/{scheduleId}/trigger:
    post:
      tags:
        - Schedules
      summary: Manually trigger schedule
      description: สั่งเล่นเสียงระฆังจากตารางเวลาที่ระบุ
      operationId: triggerSchedule
      parameters:
        - name: scheduleId
          in: path
          required: true
          description: ID ของตารางเวลา
          schema:
            type: integer
      responses:
        '200':
          description: Schedule triggered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriggerScheduleResponse'
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # User Preferences
  /preferences:
    get:
      tags:
        - Preferences
      summary: Get user preferences
      description: ดึงการตั้งค่าของผู้ใช้
      operationId: getUserPreferences
      responses:
        '200':
          description: User preferences
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPreferences'

    put:
      tags:
        - Preferences
      summary: Update user preferences
      description: อัพเดทการตั้งค่าของผู้ใช้
      operationId: updateUserPreferences
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserPreferencesRequest'
      responses:
        '200':
          description: Preferences updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserPreferences'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # Notification History
  /history:
    get:
      tags:
        - History
      summary: Get notification history
      description: ดึงประวัติการแจ้งเตือน
      operationId: getNotificationHistory
      parameters:
        - name: limit
          in: query
          description: จำนวนรายการที่ต้องการดึง
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: offset
          in: query
          description: จำนวนรายการที่ข้าม (สำหรับ pagination)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: successful_only
          in: query
          description: แสดงเฉพาะรายการที่สำเร็จ
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Notification history
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationHistoryResponse'

  # System Status & Metrics
  /status:
    get:
      tags:
        - System
      summary: Get system status
      description: ดึงสถานะปัจจุบันของระบบ
      operationId: getSystemStatus
      responses:
        '200':
          description: System status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemStatus'

  /metrics:
    get:
      tags:
        - System
      summary: Get performance metrics
      description: ดึงข้อมูลสถิติประสิทธิภาพของระบบ
      operationId: getMetrics
      responses:
        '200':
          description: Performance metrics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PerformanceMetrics'

  # WebSocket Endpoint for real-time updates
  /ws:
    get:
      tags:
        - WebSocket
      summary: WebSocket connection for real-time updates
      description: เชื่อมต่อ WebSocket เพื่อรับข้อมูลแบบ real-time
      operationId: connectWebSocket
      responses:
        '101':
          description: WebSocket connection established

components:
  schemas:
    # Health Response
    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: healthy
        version:
          type: string
          example: 1.0.0
        uptime:
          type: integer
          description: Uptime in seconds
          example: 3600
        timestamp:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    # Audio Related Schemas
    PlayBellRequest:
      type: object
      required:
        - bellTypeId
      properties:
        bellTypeId:
          type: string
          description: ID ของประเภทระฆัง
          example: "default"
        volume:
          type: number
          minimum: 0.0
          maximum: 1.0
          description: ระดับเสียง (0.0 - 1.0)
          example: 0.8
        loop:
          type: boolean
          description: เล่นซ้ำหรือไม่
          default: false
          example: false
        duration:
          type: integer
          description: ระยะเวลาเล่น (ms)
          minimum: 100
          maximum: 10000
          example: 2000

    PlayBellResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        sessionId:
          type: string
          description: ID ของเซสชันเสียง
          example: "550e8400-e29b-41d4-a716-446655440000"
        latencyMs:
          type: integer
          description: เวลาหน่วงในการเล่นเสียง
          example: 45
        playedAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    StopPlaybackResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        stoppedAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    BellType:
      type: object
      properties:
        id:
          type: string
          example: "default"
        name:
          type: string
          example: "Default Bell"
        audioFilePath:
          type: string
          example: "assets/audio/bell_default.wav"
        durationMs:
          type: integer
          example: 2000
        defaultVolume:
          type: number
          example: 0.8
        description:
          type: string
          example: "Classic bell sound"
        isSystemDefault:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    CreateBellTypeRequest:
      type: object
      required:
        - name
        - audioFilePath
        - durationMs
        - defaultVolume
      properties:
        name:
          type: string
          maxLength: 50
          example: "Gentle Chime"
        audioFilePath:
          type: string
          example: "assets/audio/bell_gentle.wav"
        durationMs:
          type: integer
          minimum: 100
          maximum: 10000
          example: 1500
        defaultVolume:
          type: number
          minimum: 0.0
          maximum: 1.0
          example: 0.6
        description:
          type: string
          maxLength: 200
          example: "Soft chime sound"
        isSystemDefault:
          type: boolean
          default: false
          example: false

    # Schedule Related Schemas
    BellSchedule:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 1
        name:
          type: string
          example: "Morning Bell"
        triggerTime:
          type: string
          pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
          example: "07:00"
        daysOfWeek:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 6
          example: [1, 2, 3, 4, 5]  # Monday-Friday
        isActive:
          type: boolean
          example: true
        bellTypeId:
          type: string
          example: "default"
        createdAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z
        updatedAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z
        lastTriggered:
          type: string
          format: date-time
          example: 2025-01-24T07:00:00Z

    CreateBellScheduleRequest:
      type: object
      required:
        - name
        - triggerTime
        - daysOfWeek
        - bellTypeId
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 50
          example: "Evening Bell"
        triggerTime:
          type: string
          pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
          example: "18:00"
        daysOfWeek:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 6
          minItems: 1
          maxItems: 7
          example: [1, 2, 3, 4, 5]
        bellTypeId:
          type: string
          example: "gentle"
        isActive:
          type: boolean
          default: true
          example: true

    UpdateBellScheduleRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 50
          example: "Updated Bell Name"
        triggerTime:
          type: string
          pattern: "^([01]?[0-9]|2[0-3]):[0-5][0-9]$"
          example: "19:00"
        daysOfWeek:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 6
          minItems: 1
          maxItems: 7
          example: [1, 3, 5]
        bellTypeId:
          type: string
          example: "loud"
        isActive:
          type: boolean
          example: false

    TriggerScheduleResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        sessionId:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000"
        latencyMs:
          type: integer
          example: 42
        triggeredAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    DeleteResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Schedule deleted successfully"

    # User Preferences Schemas
    SilentModeBehavior:
      type: string
      enum:
        - respect
        - always
        - never
        - custom
      description: พฤติกรรมเมื่อโทรศัพท์อยู่ในโหมดเงียบ

    ThemeMode:
      type: string
      enum:
        - light
        - dark
        - auto
      description: ธีมการแสดงผล

    NotificationSettings:
      type: object
      properties:
        enableNotifications:
          type: boolean
          default: true
          example: true
        enableSound:
          type: boolean
          default: true
          example: true
        enableVibration:
          type: boolean
          default: true
          example: true
        enableLed:
          type: boolean
          default: false
          example: false
        notificationSound:
          type: string
          default: "default"
          example: "gentle"
        vibrationPattern:
          type: array
          items:
            type: integer
          default: [0, 200, 100, 200]
          example: [0, 200, 100, 200]

    UserPreferences:
      type: object
      properties:
        id:
          type: integer
          example: 1
        userId:
          type: integer
          example: 1
        silentModeBehavior:
          $ref: '#/components/schemas/SilentModeBehavior'
        defaultVolume:
          type: number
          minimum: 0.0
          maximum: 1.0
          example: 0.8
        preferredBellTypeId:
          type: string
          example: "default"
        themeMode:
          $ref: '#/components/schemas/ThemeMode'
        vibrationsEnabled:
          type: boolean
          example: true
        notificationSettings:
          $ref: '#/components/schemas/NotificationSettings'
        updatedAt:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    UpdateUserPreferencesRequest:
      type: object
      properties:
        silentModeBehavior:
          $ref: '#/components/schemas/SilentModeBehavior'
        defaultVolume:
          type: number
          minimum: 0.0
          maximum: 1.0
          example: 0.9
        preferredBellTypeId:
          type: string
          example: "temple"
        themeMode:
          $ref: '#/components/schemas/ThemeMode'
        vibrationsEnabled:
          type: boolean
          example: false
        notificationSettings:
          $ref: '#/components/schemas/NotificationSettings'

    # History Related Schemas
    NotificationMetadata:
      type: object
      properties:
        sessionId:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000"
        bellTypeId:
          type: string
          example: "default"
        volumeLevel:
          type: number
          example: 0.8
        wasInBackground:
          type: boolean
          example: false
        deviceState:
          type: object
          properties:
            isCharging:
              type: boolean
              example: false
            batteryLevel:
              type: number
              example: 85.5
            networkType:
              type: string
              example: "wifi"

    NotificationHistory:
      type: object
      properties:
        id:
          type: integer
          example: 1
        scheduleId:
          type: integer
          example: 1
        triggeredAt:
          type: string
          format: date-time
          example: 2025-01-24T07:00:00Z
        wasSuccessful:
          type: boolean
          example: true
        latencyMs:
          type: integer
          example: 45
        batteryLevelAtTrigger:
          type: number
          example: 87.2
        errorMessage:
          type: string
          example: null
        metadata:
          $ref: '#/components/schemas/NotificationMetadata'

    NotificationHistoryResponse:
      type: object
      properties:
        notifications:
          type: array
          items:
            $ref: '#/components/schemas/NotificationHistory'
        total:
          type: integer
          example: 125
        limit:
          type: integer
          example: 50
        offset:
          type: integer
          example: 0
        hasMore:
          type: boolean
          example: true

    # System Status Schemas
    DeviceState:
      type: object
      properties:
        batteryLevel:
          type: number
          example: 85.5
        isCharging:
          type: boolean
          example: false
        memoryUsageMb:
          type: number
          example: 45.2
        cpuUsagePercent:
          type: number
          example: 12.3
        networkType:
          type: string
          example: "wifi"

    SystemStatus:
      type: object
      properties:
        status:
          type: string
          example: "running"
        uptime:
          type: integer
          example: 86400
        activeSchedules:
          type: integer
          example: 5
        deviceState:
          $ref: '#/components/schemas/DeviceState'
        lastScheduleCheck:
          type: string
          format: date-time
          example: 2025-01-24T10:29:00Z
        nextScheduledBell:
          type: string
          format: date-time
          example: 2025-01-24T12:00:00Z
        timestamp:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    PerformanceMetrics:
      type: object
      properties:
        audioMetrics:
          type: object
          properties:
            avgLatencyMs:
              type: number
              example: 42.5
            maxLatencyMs:
              type: integer
              example: 85
            minLatencyMs:
              type: integer
              example: 28
            totalPlaybacks:
              type: integer
              example: 1250
            successRate:
              type: number
              example: 99.2
        scheduleMetrics:
          type: object
          properties:
            totalSchedules:
              type: integer
              example: 8
            activeSchedules:
              type: integer
              example: 5
            missedSchedules:
              type: integer
              example: 2
            avgTriggerDelayMs:
              type: number
              example: 150
        systemMetrics:
          type: object
          properties:
            memoryUsageMb:
              type: number
              example: 45.2
            cpuUsagePercent:
              type: number
              example: 15.8
            batteryDrainPerHour:
              type: number
              example: 0.8
            uptimeSeconds:
              type: integer
              example: 86400
        timestamp:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

    # Error Schema
    Error:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "ValidationError"
        message:
          type: string
          example: "Invalid time format. Use HH:MM"
        details:
          type: object
          additionalProperties: true
          example:
            field: "triggerTime"
            value: "25:00"
            constraint: "Must be between 00:00 and 23:59"
        timestamp:
          type: string
          format: date-time
          example: 2025-01-24T10:30:00Z

  # Security Schemes
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

# Global Security
security:
  - ApiKeyAuth: []

# Tags for better organization
tags:
  - name: Health
    description: Health check and status endpoints
  - name: Audio
    description: Audio playback and bell management
  - name: Schedules
    description: Schedule management for automatic bell notifications
  - name: Preferences
    description: User preferences and settings
  - name: History
    description: Notification history and logs
  - name: System
    description: System status and performance metrics
  - name: WebSocket
    description: Real-time WebSocket connections